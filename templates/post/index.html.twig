{% extends './base.html.twig' %}

{% block title %}Welcome to I Can Relate
{% endblock %}


{% block body %}
	<header class="container">
		<div>
			<h2 class="title" id="author"></h2>
			<p class="lyrics" id="quote"></p>
			<div class="links">
				<div class="spotify" id="spotify"></div>
				{% if not is_granted('ROLE_USER') %}
					<a href="{{path('app_login')}}" class="nav-link">If you want save your choice, you need to sign in</a>
				{% else %}
					<div class="button-box">
						<button class="button--red" id="dontRelate" onclick="getNewQuote()">
							<a href="" class="btn btn-link js-likes">I don't Relate --skip--</a>
						</button>
						<button class="button--green" onclick="getNewQuote()">
							<a href="" id="link" class="btn btn-link js-likes">I Can Relate</a>
						</button>
					{% endif %}
				</div>
				<button class="button--green" onclick="getNewQuote()">Get a new quote</button>
			</div>
		</div>
	</header>
{% endblock %}

{% block javascripts %}
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>


<script>
// like function
document.querySelectorAll('a.js-likes').forEach(function (link) {
link.addEventListener('click', onClickBtnLike);
})
// function for display data when html is ready
document.addEventListener('DOMContentLoaded', function() {
  getNewQuote();
});
</script>

<script>
// id div & links
const text = document.getElementById("quote");
const author = document.getElementById("author");
const spotify = document.getElementById("spotify");
const link = document.getElementById("link");
const loginFirst = document.getElementById("login");

// api function
const getNewQuote = async () => {
let urlapi = "http://127.0.0.1:8000/api/posts";
console.log(urlapi);
const response = await fetch(urlapi);
const allQuotes = await response.json();
console.log(allQuotes);
// Generates a random number between 0 and the length of the quotes array
const index = Math.floor(Math.random() * allQuotes.length);

// Store the data
let quote = allQuotes[index].title;
let auth = allQuotes[index].introduction;
let spotifysong = allQuotes[index].content;
let likeSong = allQuotes[index].id

// Display the data
text.innerHTML = quote;
author.innerHTML = auth;
spotify.innerHTML = '<iframe src="https://open.spotify.com/embed/track/' + spotifysong + '?utm_source=generator&theme=0"  width="100%" height="80" frameborder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>';
// Display for the href attribute
document.getElementById("link").removeAttribute("href");
document.getElementById("link").setAttribute("href", "/post/" + likeSong + "/likes");
}
	</script>
{% endblock  %}
