{% extends './base.html.twig' %}

{% block title %}Welcome to I Can Relate
{% endblock %}


{% block stylesheets %}
	<style>
		body {
			background: white;
			color: #323232;
			margin: 0;
			height: 100vh;
			/* display: flex; */
			align-items: center;
			justify-content: center;
			font-family: Helvetica neue, roboto;
		}

		.container {
			margin: 0 auto;
			min-height: 100vh;
			display: flex;
			justify-content: center;
			align-items: center;
			text-align: center;
		}

		a {
			text-decoration: none;
			color: white;
		}

		.title {
			font-family: "Quicksand", "Source Sans Pro", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
			display: block;
			font-weight: 300;
			font-size: 30px;
			color: #35495e;
			letter-spacing: 1px;
			margin-top: 0;
			margin-bottom: 30px;
		}

		.lyrics {
			font-family: "Quicksand", "Source Sans Pro", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
			display: block;
			font-weight: 300;
			font-size: 20px;
			color: #35495e;
			letter-spacing: 1px;
			margin-bottom: 15px;
		}

		.links {
			padding-top: 30px;
			padding-bottom: 30px;
		}

		.spotify {
			padding-bottom: 30px;
		}

		html {
			font-family: "Source Sans Pro", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
			font-size: 16px;
			word-spacing: 1px;
			-ms-text-size-adjust: 100%;
			-webkit-text-size-adjust: 100%;
			-moz-osx-font-smoothing: grayscale;
			-webkit-font-smoothing: antialiased;
			box-sizing: border-box;
		}

		*,
		*::before,
		*::after {
			box-sizing: border-box;
			margin: 0;
		}

		.button--green {
			display: inline-block;
			border-radius: 30px;
			border: 3px solid #3b8070;
			color: #3b8070;
			text-decoration: none;
			padding: 10px 30px;
		}

		.button--green--validate {
			display: inline-block;
			border-radius: 30px;
			border: 3px solid #3b8070;
			color: #white;
			background-color: #3b8070;
			text-decoration: none;
			padding: 10px 30px;
		}

		.button--green:hover {
			color: #fff;
			background-color: #3b8070;
		}

		.button--red {
			display: inline-block;
			border-radius: 30px;
			border: 1px solid red;
			color: red;
			text-decoration: none;
			padding: 10px 30px;
		}

		.button--red:hover {
			color: #fff;
			background-color: red;
		}

		.button-box {
			padding-top: 30px;
		}
	</style>

{% endblock %}


{% block body %}
	<!--- //TODO: meilleur placement pour le connexion, ajouter la page profil -->
	<nav class="navbar navbar-expand-lg navbar-light bg-primary">
		<div class="container-fluid">
			<a class="navbar-brand" href="#">I Can Relate</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarNav">


				<ul class="navbar-nav">
					<li class="nav-item">
					{% if not is_granted('ROLE_USER') %}
						<a href="/login" class="nav-link">Connexion</a>
					{% else %}
						<a href="/logout" class="nav-link">DÃ©connexion</a>
					{% endif %}
					</li>
					<li class="nav-item">
						<a class="nav-link active" href="{{path('homepage')}}" aria-current="page" href="#">Home</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="{{path('favoris')}}">Favoris</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="{{path('about')}}">About</a>

					</li>
				</ul>
			</div>
		</div>
	</nav>

	<div class="container">
		<div>
			<h2 class="title" id="author"></h2>
			<p class="lyrics" id="quote"></p>
			<div class="links">
				<div class="spotify" id="spotify"></div>
				{% if not is_granted('ROLE_USER') %}
					<p id="login">If you want save your choice, you need to login first</p>
				{% else %}
					<div class="button-box">
						<button class="button--red" id="dontRelate" onclick="getNewQuote()">
							<a href="" class="btn btn-link js-likes">I don't Relate --skip--</a>
						</button>
						<button class="button--green" onclick="getNewQuote()">
							<a href="" id="link" class="btn btn-link js-likes">I Can Relate</a>
						</button>
					{% endif %}
				</div>
				<button class="button--green" onclick="getNewQuote()">Get a new quote</button>
			</div>
		</div>
	</div>
{% endblock %}

{% block javascripts %}
	<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

	<script>
		function onClickBtnLike(event) {
event.preventDefault();
const url = this.href;
console.log(url);
axios.get(url).then(function (response) {
const likes = response.data;
console.log(likes);
spanCount.textContent = likes;
getNewQuote();
}).catch(function (error) {
if (error.response.status == 403) {
window.alert('Connectez-vous');

}
});
}
document.querySelectorAll('a.js-likes').forEach(function (link) {
link.addEventListener('click', onClickBtnLike);
})
	</script>


	<script>
		// id of div & links
const text = document.getElementById("quote");
const author = document.getElementById("author");
const spotify = document.getElementById("spotify");
const link = document.getElementById("link");
const loginFirst = document.getElementById("login");

// api function
const getNewQuote = async () => {
let urlapi = "http://127.0.0.1:8000/api/posts";
const response = await fetch(urlapi);
const allQuotes = await response.json();
console.log(allQuotes);
// Generates a random number between 0 and the length of the quotes array
const index = Math.floor(Math.random() * allQuotes.length);

// Store the data
let quote = allQuotes[index].title;
let auth = allQuotes[index].introduction;
let spotifysong = allQuotes[index].content;
let likeSong = allQuotes[index].id

// Display the data
text.innerHTML = quote;
author.innerHTML = auth;
spotify.innerHTML = '<iframe src="https://open.spotify.com/embed/track/' + spotifysong + '?utm_source=generator&theme=0"  width="100%" height="80" frameborder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture"></iframe>';
// Display for the href attribute
document.getElementById("link").removeAttribute("href");
document.getElementById("link").setAttribute("href", "/post/" + likeSong + "/likes");
}
	</script>
{% endblock  %}
